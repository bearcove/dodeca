# GENERATED BY: cargo xtask ci
# DO NOT EDIT - edit xtask/src/ci.rs instead

---
name: CI
"on": 
  push: 
    tags: 
      - v*
    branches: 
      - main
  pull_request: 
    branches: 
      - main
  workflow_dispatch: {}
permissions: 
  contents: read
env: 
  CARGO_TERM_COLOR: always
jobs: 
  build-wasm: 
    name: Build WASM
    runs-on: 
      - linux-amd64-metal
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
          targets: wasm32-unknown-unknown
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/wasm" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/wasm..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/wasm" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/wasm" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/wasm"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/wasm"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/wasm" cargo sweep --stamp
      - name: Build WASM
        run: cargo xtask wasm
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/wasm")"
          rm -rf "/home/amos/.cache/dodeca-ci/wasm" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/wasm" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/wasm" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/wasm" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/wasm" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/wasm to trim"
          fi
      - name: Upload WASM to CAS
        run: |-
          tar -czf /tmp/wasm.tar.gz -C crates/dodeca-devtools pkg
          ./scripts/cas-upload.ts /tmp/wasm.tar.gz "ci/${{ github.run_id }}/wasm.tar.gz"
  clippy: 
    name: Clippy
    runs-on: 
      - linux-amd64-metal
    timeout-minutes: 30
    needs: 
      - build-wasm
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    continue-on-error: true
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
          components: clippy
          targets: wasm32-unknown-unknown
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/clippy" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/clippy..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/clippy" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/clippy" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/clippy"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/clippy"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/clippy" cargo sweep --stamp
      - name: Download WASM from CAS
        run: |-
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/wasm.tar.gz" /tmp/wasm.tar.gz
          mkdir -p crates/dodeca-devtools
          tar -xzf /tmp/wasm.tar.gz -C crates/dodeca-devtools
      - name: Clippy
        run: cargo clippy --all-features --all-targets -- -D warnings
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/clippy")"
          rm -rf "/home/amos/.cache/dodeca-ci/clippy" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/clippy" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/clippy" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/clippy" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/clippy" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/clippy to trim"
          fi
  build-ddc-linux-x64: 
    name: Build ddc (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    needs: 
      - build-wasm
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/ddc-linux-x64" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/ddc-linux-x64..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/ddc-linux-x64" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/ddc-linux-x64" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/ddc-linux-x64"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/ddc-linux-x64"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/ddc-linux-x64" cargo sweep --stamp
      - name: Download WASM from CAS
        run: |-
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/wasm.tar.gz" /tmp/wasm.tar.gz
          mkdir -p crates/dodeca-devtools
          tar -xzf /tmp/wasm.tar.gz -C crates/dodeca-devtools
      - name: Debug proc-macro2 mtimes
        run: |-
          set -euo pipefail
          if ls target/debug/build/proc-macro2-*/build-script-build >/dev/null 2>&1; then
            if stat -c %y target/debug/build/proc-macro2-*/build-script-build >/dev/null 2>&1; then
              stat -c %y target/debug/build/proc-macro2-*/build-script-build
            else
              stat -f %m target/debug/build/proc-macro2-*/build-script-build
            fi
          else
            echo "No proc-macro2 build-script-build file found"
          fi
        shell: bash
      - name: Build ddc
        run: cargo build --release -p dodeca --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/ddc-linux-x64")"
          rm -rf "/home/amos/.cache/dodeca-ci/ddc-linux-x64" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/ddc-linux-x64" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/ddc-linux-x64" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/ddc-linux-x64" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/ddc-linux-x64" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/ddc-linux-x64 to trim"
          fi
      - name: Test ddc
        run: cargo test --release -p dodeca --bins
      - name: Upload ddc to CAS
        run: "./scripts/cas-upload.ts target/release/ddc \"ci/${{ github.run_id }}/ddc-linux-x64\""
  build-cells-linux-x64-1: 
    name: Build cells (linux-x64) [cell-code-execution]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-1" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-1..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-1" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-1" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-1"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-1"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-1" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-code-execution --bin ddc-cell-code-execution --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-1")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-1" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-1" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-1" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-1" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-1" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-1 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-code-execution
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-1\" target/release/ddc-cell-code-execution"
  build-cells-linux-x64-2: 
    name: Build cells (linux-x64) [cell-css]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-2" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-2..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-2" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-2" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-2"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-2"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-2" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-css --bin ddc-cell-css --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-2")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-2" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-2" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-2" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-2" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-2" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-2 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-css
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-2\" target/release/ddc-cell-css"
  build-cells-linux-x64-3: 
    name: Build cells (linux-x64) [cell-dialoguer]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-3" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-3..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-3" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-3" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-3"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-3"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-3" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-dialoguer --bin ddc-cell-dialoguer --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-3")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-3" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-3" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-3" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-3" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-3" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-3 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-dialoguer
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-3\" target/release/ddc-cell-dialoguer"
  build-cells-linux-x64-4: 
    name: Build cells (linux-x64) [cell-fonts]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-4" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-4..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-4" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-4" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-4"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-4"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-4" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-fonts --bin ddc-cell-fonts --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-4")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-4" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-4" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-4" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-4" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-4" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-4 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-fonts
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-4\" target/release/ddc-cell-fonts"
  build-cells-linux-x64-5: 
    name: Build cells (linux-x64) [cell-gingembre]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-5" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-5..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-5" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-5" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-5"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-5"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-5" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-gingembre --bin ddc-cell-gingembre --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-5")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-5" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-5" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-5" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-5" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-5" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-5 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-gingembre
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-5\" target/release/ddc-cell-gingembre"
  build-cells-linux-x64-6: 
    name: Build cells (linux-x64) [cell-html]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-6" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-6..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-6" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-6" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-6"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-6"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-6" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-html --bin ddc-cell-html --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-6")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-6" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-6" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-6" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-6" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-6" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-6 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-html
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-6\" target/release/ddc-cell-html"
  build-cells-linux-x64-7: 
    name: Build cells (linux-x64) [cell-html-diff]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-7" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-7..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-7" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-7" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-7"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-7"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-7" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-html-diff --bin ddc-cell-html-diff --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-7")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-7" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-7" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-7" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-7" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-7" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-7 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-html-diff
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-7\" target/release/ddc-cell-html-diff"
  build-cells-linux-x64-8: 
    name: Build cells (linux-x64) [cell-http]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-8" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-8..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-8" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-8" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-8"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-8"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-8" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-http --bin ddc-cell-http --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-8")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-8" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-8" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-8" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-8" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-8" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-8 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-http
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-8\" target/release/ddc-cell-http"
  build-cells-linux-x64-9: 
    name: Build cells (linux-x64) [cell-image]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-9" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-9..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-9" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-9" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-9"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-9"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-9" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-image --bin ddc-cell-image --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-9")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-9" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-9" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-9" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-9" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-9" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-9 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-image
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-9\" target/release/ddc-cell-image"
  build-cells-linux-x64-10: 
    name: Build cells (linux-x64) [cell-js]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-10" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-10..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-10" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-10" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-10"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-10"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-10" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-js --bin ddc-cell-js --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-10")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-10" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-10" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-10" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-10" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-10" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-10 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-js
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-10\" target/release/ddc-cell-js"
  build-cells-linux-x64-11: 
    name: Build cells (linux-x64) [cell-jxl]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-11" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-11..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-11" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-11" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-11"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-11"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-11" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-jxl --bin ddc-cell-jxl --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-11")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-11" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-11" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-11" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-11" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-11" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-11 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-jxl
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-11\" target/release/ddc-cell-jxl"
  build-cells-linux-x64-12: 
    name: Build cells (linux-x64) [cell-linkcheck]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-12" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-12..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-12" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-12" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-12"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-12"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-12" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-linkcheck --bin ddc-cell-linkcheck --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-12")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-12" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-12" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-12" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-12" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-12" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-12 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-linkcheck
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-12\" target/release/ddc-cell-linkcheck"
  build-cells-linux-x64-13: 
    name: Build cells (linux-x64) [cell-markdown]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-13" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-13..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-13" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-13" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-13"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-13"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-13" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-markdown --bin ddc-cell-markdown --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-13")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-13" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-13" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-13" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-13" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-13" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-13 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-markdown
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-13\" target/release/ddc-cell-markdown"
  build-cells-linux-x64-14: 
    name: Build cells (linux-x64) [cell-minify]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-14" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-14..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-14" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-14" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-14"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-14"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-14" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-minify --bin ddc-cell-minify --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-14")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-14" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-14" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-14" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-14" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-14" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-14 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-minify
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-14\" target/release/ddc-cell-minify"
  build-cells-linux-x64-15: 
    name: Build cells (linux-x64) [cell-sass]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-15" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-15..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-15" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-15" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-15"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-15"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-15" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-sass --bin ddc-cell-sass --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-15")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-15" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-15" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-15" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-15" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-15" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-15 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-sass
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-15\" target/release/ddc-cell-sass"
  build-cells-linux-x64-16: 
    name: Build cells (linux-x64) [cell-svgo]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-16" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-16..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-16" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-16" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-16"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-16"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-16" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-svgo --bin ddc-cell-svgo --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-16")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-16" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-16" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-16" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-16" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-16" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-16 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-svgo
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-16\" target/release/ddc-cell-svgo"
  build-cells-linux-x64-17: 
    name: Build cells (linux-x64) [cell-term]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-17" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-17..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-17" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-17" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-17"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-17"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-17" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-term --bin ddc-cell-term --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-17")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-17" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-17" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-17" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-17" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-17" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-17 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-term
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-17\" target/release/ddc-cell-term"
  build-cells-linux-x64-18: 
    name: Build cells (linux-x64) [cell-tui]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-18" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-18..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-18" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-18" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-18"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-18"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-18" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-tui --bin ddc-cell-tui --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-18")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-18" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-18" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-18" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-18" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-18" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-18 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-tui
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-18\" target/release/ddc-cell-tui"
  build-cells-linux-x64-19: 
    name: Build cells (linux-x64) [cell-webp]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-19" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/cells-linux-x64-19..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/cells-linux-x64-19" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/cells-linux-x64-19" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-19"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/cells-linux-x64-19"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-19" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-webp --bin ddc-cell-webp --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/cells-linux-x64-19")"
          rm -rf "/home/amos/.cache/dodeca-ci/cells-linux-x64-19" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/cells-linux-x64-19" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/cells-linux-x64-19" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/cells-linux-x64-19" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/cells-linux-x64-19" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/cells-linux-x64-19 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-webp
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-linux-x64-19\" target/release/ddc-cell-webp"
  integration-linux-x64: 
    name: Integration (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    needs: 
      - build-ddc-linux-x64
      - build-cells-linux-x64-1
      - build-cells-linux-x64-2
      - build-cells-linux-x64-3
      - build-cells-linux-x64-4
      - build-cells-linux-x64-5
      - build-cells-linux-x64-6
      - build-cells-linux-x64-7
      - build-cells-linux-x64-8
      - build-cells-linux-x64-9
      - build-cells-linux-x64-10
      - build-cells-linux-x64-11
      - build-cells-linux-x64-12
      - build-cells-linux-x64-13
      - build-cells-linux-x64-14
      - build-cells-linux-x64-15
      - build-cells-linux-x64-16
      - build-cells-linux-x64-17
      - build-cells-linux-x64-18
      - build-cells-linux-x64-19
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/integration-linux-x64" ]; then
            echo "Restoring cache from /home/amos/.cache/dodeca-ci/integration-linux-x64..."
            rm -rf target 2>/dev/null || true
            ctree "/home/amos/.cache/dodeca-ci/integration-linux-x64" target && echo "Cache restored via ctree from /home/amos/.cache/dodeca-ci/integration-linux-x64" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/integration-linux-x64"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/home/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /home/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/home/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/home/amos/.cache/dodeca-ci/integration-linux-x64"
          CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/integration-linux-x64" cargo sweep --stamp
      - name: Build integration-tests
        run: cargo build -p integration-tests
      - name: Download ddc from CAS
        run: "./scripts/cas-download.ts \"ci/${{ github.run_id }}/ddc-linux-x64\" dist/ddc"
      - name: Download cells from CAS
        run: |-
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-1" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-2" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-3" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-4" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-5" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-6" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-7" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-8" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-9" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-10" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-11" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-12" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-13" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-14" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-15" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-16" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-17" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-18" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-19" dist/
      - name: List binaries
        run: ls -la dist/
      - name: Verify artifacts
        run: |
          #!/bin/bash
          set -euo pipefail
          
          echo 'Verifying all required binaries exist in dist/'
          missing=0
          
          if [[ ! -x dist/ddc ]]; then
            echo ' MISSING: ddc'
            missing=1
          else
            echo ' ddc'
          fi
          
          if [[ ! -x dist/ddc-cell-code-execution ]]; then
            echo ' MISSING: ddc-cell-code-execution'
            missing=1
          else
            echo ' ddc-cell-code-execution'
          fi
          
          if [[ ! -x dist/ddc-cell-css ]]; then
            echo ' MISSING: ddc-cell-css'
            missing=1
          else
            echo ' ddc-cell-css'
          fi
          
          if [[ ! -x dist/ddc-cell-dialoguer ]]; then
            echo ' MISSING: ddc-cell-dialoguer'
            missing=1
          else
            echo ' ddc-cell-dialoguer'
          fi
          
          if [[ ! -x dist/ddc-cell-fonts ]]; then
            echo ' MISSING: ddc-cell-fonts'
            missing=1
          else
            echo ' ddc-cell-fonts'
          fi
          
          if [[ ! -x dist/ddc-cell-gingembre ]]; then
            echo ' MISSING: ddc-cell-gingembre'
            missing=1
          else
            echo ' ddc-cell-gingembre'
          fi
          
          if [[ ! -x dist/ddc-cell-html ]]; then
            echo ' MISSING: ddc-cell-html'
            missing=1
          else
            echo ' ddc-cell-html'
          fi
          
          if [[ ! -x dist/ddc-cell-html-diff ]]; then
            echo ' MISSING: ddc-cell-html-diff'
            missing=1
          else
            echo ' ddc-cell-html-diff'
          fi
          
          if [[ ! -x dist/ddc-cell-http ]]; then
            echo ' MISSING: ddc-cell-http'
            missing=1
          else
            echo ' ddc-cell-http'
          fi
          
          if [[ ! -x dist/ddc-cell-image ]]; then
            echo ' MISSING: ddc-cell-image'
            missing=1
          else
            echo ' ddc-cell-image'
          fi
          
          if [[ ! -x dist/ddc-cell-js ]]; then
            echo ' MISSING: ddc-cell-js'
            missing=1
          else
            echo ' ddc-cell-js'
          fi
          
          if [[ ! -x dist/ddc-cell-jxl ]]; then
            echo ' MISSING: ddc-cell-jxl'
            missing=1
          else
            echo ' ddc-cell-jxl'
          fi
          
          if [[ ! -x dist/ddc-cell-linkcheck ]]; then
            echo ' MISSING: ddc-cell-linkcheck'
            missing=1
          else
            echo ' ddc-cell-linkcheck'
          fi
          
          if [[ ! -x dist/ddc-cell-markdown ]]; then
            echo ' MISSING: ddc-cell-markdown'
            missing=1
          else
            echo ' ddc-cell-markdown'
          fi
          
          if [[ ! -x dist/ddc-cell-minify ]]; then
            echo ' MISSING: ddc-cell-minify'
            missing=1
          else
            echo ' ddc-cell-minify'
          fi
          
          if [[ ! -x dist/ddc-cell-sass ]]; then
            echo ' MISSING: ddc-cell-sass'
            missing=1
          else
            echo ' ddc-cell-sass'
          fi
          
          if [[ ! -x dist/ddc-cell-svgo ]]; then
            echo ' MISSING: ddc-cell-svgo'
            missing=1
          else
            echo ' ddc-cell-svgo'
          fi
          
          if [[ ! -x dist/ddc-cell-term ]]; then
            echo ' MISSING: ddc-cell-term'
            missing=1
          else
            echo ' ddc-cell-term'
          fi
          
          if [[ ! -x dist/ddc-cell-tui ]]; then
            echo ' MISSING: ddc-cell-tui'
            missing=1
          else
            echo ' ddc-cell-tui'
          fi
          
          if [[ ! -x dist/ddc-cell-webp ]]; then
            echo ' MISSING: ddc-cell-webp'
            missing=1
          else
            echo ' ddc-cell-webp'
          fi
          
          if [[ $missing -eq 1 ]]; then
            echo ''
            echo 'ERROR: Some required binaries are missing!'
            echo 'This usually means a cell build job failed or artifact upload was incomplete.'
            exit 1
          fi
          
          echo ''
          echo 'All 20 binaries verified.'
      - name: Run integration tests
        run: cargo xtask integration --no-build
        env: 
          DODECA_BIN: ${{ github.workspace }}/dist/ddc
          DODECA_CELL_PATH: ${{ github.workspace }}/dist
          DODECA_TEST_FIXTURES_DIR: ${{ github.workspace }}/crates/integration-tests/fixtures
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/home/amos/.cache/dodeca-ci/integration-linux-x64")"
          rm -rf "/home/amos/.cache/dodeca-ci/integration-linux-x64" 2>/dev/null || true
          ctree target "/home/amos/.cache/dodeca-ci/integration-linux-x64" && echo "Cache saved via ctree to /home/amos/.cache/dodeca-ci/integration-linux-x64" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/home/amos/.cache/dodeca-ci/integration-linux-x64" ]; then
            CARGO_TARGET_DIR="/home/amos/.cache/dodeca-ci/integration-linux-x64" cargo sweep --file || true
          else
            echo "No cache found at /home/amos/.cache/dodeca-ci/integration-linux-x64 to trim"
          fi
  assemble-linux-x64: 
    name: Assemble (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    needs: 
      - integration-linux-x64
      - build-wasm
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Download ddc from CAS
        run: "./scripts/cas-download.ts \"ci/${{ github.run_id }}/ddc-linux-x64\" target/release/ddc"
      - name: Download cells from CAS
        run: |-
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-1" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-2" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-3" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-4" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-5" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-6" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-7" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-8" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-9" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-10" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-11" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-12" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-13" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-14" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-15" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-16" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-17" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-18" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-linux-x64-19" target/release/
      - name: Download WASM from CAS
        run: |-
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/wasm.tar.gz" /tmp/wasm.tar.gz
          mkdir -p crates/dodeca-devtools
          tar -xzf /tmp/wasm.tar.gz -C crates/dodeca-devtools
      - name: Install xz (macOS)
        run: if command -v brew >/dev/null 2>&1; then HOMEBREW_NO_AUTO_UPDATE=1 brew install xz; fi
      - name: List binaries
        run: ls -la target/release/
      - name: Assemble archive
        run: bash scripts/assemble-archive.sh x86_64-unknown-linux-gnu
      - name: Upload archive to CAS
        run: "./scripts/cas-upload.ts \"dodeca-x86_64-unknown-linux-gnu.tar.xz\" \"ci/${{ github.run_id }}/dodeca-x86_64-unknown-linux-gnu.tar.xz\""
  build-ddc-macos-arm64: 
    name: Build ddc (macos-arm64)
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    needs: 
      - build-wasm
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/ddc-macos-arm64..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/ddc-macos-arm64" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/ddc-macos-arm64"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" cargo sweep --stamp
      - name: Download WASM from CAS
        run: |-
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/wasm.tar.gz" /tmp/wasm.tar.gz
          mkdir -p crates/dodeca-devtools
          tar -xzf /tmp/wasm.tar.gz -C crates/dodeca-devtools
      - name: Debug proc-macro2 mtimes
        run: |-
          set -euo pipefail
          if ls target/debug/build/proc-macro2-*/build-script-build >/dev/null 2>&1; then
            if stat -c %y target/debug/build/proc-macro2-*/build-script-build >/dev/null 2>&1; then
              stat -c %y target/debug/build/proc-macro2-*/build-script-build
            else
              stat -f %m target/debug/build/proc-macro2-*/build-script-build
            fi
          else
            echo "No proc-macro2 build-script-build file found"
          fi
        shell: bash
      - name: Build ddc
        run: cargo build --release -p dodeca --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64")"
          rm -rf "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/ddc-macos-arm64" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/ddc-macos-arm64" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/ddc-macos-arm64 to trim"
          fi
      - name: Test ddc
        run: cargo test --release -p dodeca --bins
      - name: Upload ddc to CAS
        run: "./scripts/cas-upload.ts target/release/ddc \"ci/${{ github.run_id }}/ddc-macos-arm64\""
  build-cells-macos-arm64-1: 
    name: Build cells (macos-arm64) [cell-code-execution]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-1..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-1"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-code-execution --bin ddc-cell-code-execution --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-1" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-1 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-code-execution
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-1\" target/release/ddc-cell-code-execution"
  build-cells-macos-arm64-2: 
    name: Build cells (macos-arm64) [cell-css]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-2..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-2"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-css --bin ddc-cell-css --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-2" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-2 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-css
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-2\" target/release/ddc-cell-css"
  build-cells-macos-arm64-3: 
    name: Build cells (macos-arm64) [cell-dialoguer]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-3..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-3"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-dialoguer --bin ddc-cell-dialoguer --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-3" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-3 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-dialoguer
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-3\" target/release/ddc-cell-dialoguer"
  build-cells-macos-arm64-4: 
    name: Build cells (macos-arm64) [cell-fonts]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-4..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-4"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-fonts --bin ddc-cell-fonts --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-4" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-4 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-fonts
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-4\" target/release/ddc-cell-fonts"
  build-cells-macos-arm64-5: 
    name: Build cells (macos-arm64) [cell-gingembre]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-5..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-5"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-gingembre --bin ddc-cell-gingembre --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-5" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-5 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-gingembre
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-5\" target/release/ddc-cell-gingembre"
  build-cells-macos-arm64-6: 
    name: Build cells (macos-arm64) [cell-html]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-6..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-6"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-html --bin ddc-cell-html --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-6" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-6 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-html
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-6\" target/release/ddc-cell-html"
  build-cells-macos-arm64-7: 
    name: Build cells (macos-arm64) [cell-html-diff]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-7..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-7"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-html-diff --bin ddc-cell-html-diff --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-7" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-7 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-html-diff
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-7\" target/release/ddc-cell-html-diff"
  build-cells-macos-arm64-8: 
    name: Build cells (macos-arm64) [cell-http]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-8..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-8"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-http --bin ddc-cell-http --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-8" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-8 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-http
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-8\" target/release/ddc-cell-http"
  build-cells-macos-arm64-9: 
    name: Build cells (macos-arm64) [cell-image]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-9..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-9"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-image --bin ddc-cell-image --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-9" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-9 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-image
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-9\" target/release/ddc-cell-image"
  build-cells-macos-arm64-10: 
    name: Build cells (macos-arm64) [cell-js]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-10..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-10"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-js --bin ddc-cell-js --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-10" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-10 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-js
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-10\" target/release/ddc-cell-js"
  build-cells-macos-arm64-11: 
    name: Build cells (macos-arm64) [cell-jxl]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-11..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-11"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-jxl --bin ddc-cell-jxl --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-11" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-11 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-jxl
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-11\" target/release/ddc-cell-jxl"
  build-cells-macos-arm64-12: 
    name: Build cells (macos-arm64) [cell-linkcheck]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-12..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-12"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-linkcheck --bin ddc-cell-linkcheck --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-12" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-12 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-linkcheck
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-12\" target/release/ddc-cell-linkcheck"
  build-cells-macos-arm64-13: 
    name: Build cells (macos-arm64) [cell-markdown]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-13..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-13"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-markdown --bin ddc-cell-markdown --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-13" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-13 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-markdown
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-13\" target/release/ddc-cell-markdown"
  build-cells-macos-arm64-14: 
    name: Build cells (macos-arm64) [cell-minify]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-14..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-14"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-minify --bin ddc-cell-minify --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-14" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-14 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-minify
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-14\" target/release/ddc-cell-minify"
  build-cells-macos-arm64-15: 
    name: Build cells (macos-arm64) [cell-sass]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-15..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-15"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-sass --bin ddc-cell-sass --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-15" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-15 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-sass
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-15\" target/release/ddc-cell-sass"
  build-cells-macos-arm64-16: 
    name: Build cells (macos-arm64) [cell-svgo]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-16..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-16"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-svgo --bin ddc-cell-svgo --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-16" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-16 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-svgo
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-16\" target/release/ddc-cell-svgo"
  build-cells-macos-arm64-17: 
    name: Build cells (macos-arm64) [cell-term]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-17..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-17"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-term --bin ddc-cell-term --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-17" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-17 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-term
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-17\" target/release/ddc-cell-term"
  build-cells-macos-arm64-18: 
    name: Build cells (macos-arm64) [cell-tui]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-18..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-18"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-tui --bin ddc-cell-tui --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-18" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-18 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-tui
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-18\" target/release/ddc-cell-tui"
  build-cells-macos-arm64-19: 
    name: Build cells (macos-arm64) [cell-webp]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-19..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-19"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" cargo sweep --stamp
      - name: Build cells
        run: cargo build --release -p cell-webp --bin ddc-cell-webp --verbose
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19")"
          rm -rf "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/cells-macos-arm64-19" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/cells-macos-arm64-19 to trim"
          fi
      - name: Test cells
        run: cargo test --release -p cell-webp
      - name: Upload cells to CAS
        run: "./scripts/cas-upload-batch.ts \"ci/${{ github.run_id }}/cells-macos-arm64-19\" target/release/ddc-cell-webp"
  integration-macos-arm64: 
    name: Integration (macos-arm64)
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    needs: 
      - build-ddc-macos-arm64
      - build-cells-macos-arm64-1
      - build-cells-macos-arm64-2
      - build-cells-macos-arm64-3
      - build-cells-macos-arm64-4
      - build-cells-macos-arm64-5
      - build-cells-macos-arm64-6
      - build-cells-macos-arm64-7
      - build-cells-macos-arm64-8
      - build-cells-macos-arm64-9
      - build-cells-macos-arm64-10
      - build-cells-macos-arm64-11
      - build-cells-macos-arm64-12
      - build-cells-macos-arm64-13
      - build-cells-macos-arm64-14
      - build-cells-macos-arm64-15
      - build-cells-macos-arm64-16
      - build-cells-macos-arm64-17
      - build-cells-macos-arm64-18
      - build-cells-macos-arm64-19
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Install Rust
        uses: "https://github.com/dtolnay/rust-toolchain@master"
        with: 
          toolchain: 1.92.0
      - name: Restore cache (ctree)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/integration-macos-arm64" ]; then
            echo "Restoring cache from /Users/amos/.cache/dodeca-ci/integration-macos-arm64..."
            rm -rf target 2>/dev/null || true
            ctree "/Users/amos/.cache/dodeca-ci/integration-macos-arm64" target && echo "Cache restored via ctree from /Users/amos/.cache/dodeca-ci/integration-macos-arm64" || echo "ctree failed, starting fresh"
            du -sh target 2>/dev/null || true
            echo "=== Cache contents after restore ==="
            tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          
            # CMake build directories are not relocatable - they contain absolute paths.
            # Nuke them to force a fresh CMake configure on path changes.
            find target -path '*/build/*/out/build/CMakeCache.txt' -delete 2>/dev/null || true
            find target -path '*/build/*/out/build/CMakeFiles' -type d -exec rm -rf {} + 2>/dev/null || true
            echo "Cleaned CMake caches (non-relocatable)"
          
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/integration-macos-arm64"
          fi
      - name: Timelord cache info (before sync)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/timelord" ]; then
            timelord cache-info --cache-dir "/Users/amos/.cache/dodeca-ci/timelord"
          else
            echo "No timelord cache dir at /Users/amos/.cache/dodeca-ci/timelord"
          fi
      - name: Restore source mtimes (timelord)
        run: "timelord sync --source-dir . --cache-dir \"/Users/amos/.cache/dodeca-ci/timelord\""
      - name: Stamp cache artifacts (cargo sweep)
        run: |-
          mkdir -p "/Users/amos/.cache/dodeca-ci/integration-macos-arm64"
          CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/integration-macos-arm64" cargo sweep --stamp
      - name: Build integration-tests
        run: cargo build -p integration-tests
      - name: Download ddc from CAS
        run: "./scripts/cas-download.ts \"ci/${{ github.run_id }}/ddc-macos-arm64\" dist/ddc"
      - name: Download cells from CAS
        run: |-
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-1" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-2" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-3" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-4" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-5" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-6" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-7" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-8" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-9" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-10" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-11" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-12" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-13" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-14" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-15" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-16" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-17" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-18" dist/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-19" dist/
      - name: List binaries
        run: ls -la dist/
      - name: Verify artifacts
        run: |
          #!/bin/bash
          set -euo pipefail
          
          echo 'Verifying all required binaries exist in dist/'
          missing=0
          
          if [[ ! -x dist/ddc ]]; then
            echo ' MISSING: ddc'
            missing=1
          else
            echo ' ddc'
          fi
          
          if [[ ! -x dist/ddc-cell-code-execution ]]; then
            echo ' MISSING: ddc-cell-code-execution'
            missing=1
          else
            echo ' ddc-cell-code-execution'
          fi
          
          if [[ ! -x dist/ddc-cell-css ]]; then
            echo ' MISSING: ddc-cell-css'
            missing=1
          else
            echo ' ddc-cell-css'
          fi
          
          if [[ ! -x dist/ddc-cell-dialoguer ]]; then
            echo ' MISSING: ddc-cell-dialoguer'
            missing=1
          else
            echo ' ddc-cell-dialoguer'
          fi
          
          if [[ ! -x dist/ddc-cell-fonts ]]; then
            echo ' MISSING: ddc-cell-fonts'
            missing=1
          else
            echo ' ddc-cell-fonts'
          fi
          
          if [[ ! -x dist/ddc-cell-gingembre ]]; then
            echo ' MISSING: ddc-cell-gingembre'
            missing=1
          else
            echo ' ddc-cell-gingembre'
          fi
          
          if [[ ! -x dist/ddc-cell-html ]]; then
            echo ' MISSING: ddc-cell-html'
            missing=1
          else
            echo ' ddc-cell-html'
          fi
          
          if [[ ! -x dist/ddc-cell-html-diff ]]; then
            echo ' MISSING: ddc-cell-html-diff'
            missing=1
          else
            echo ' ddc-cell-html-diff'
          fi
          
          if [[ ! -x dist/ddc-cell-http ]]; then
            echo ' MISSING: ddc-cell-http'
            missing=1
          else
            echo ' ddc-cell-http'
          fi
          
          if [[ ! -x dist/ddc-cell-image ]]; then
            echo ' MISSING: ddc-cell-image'
            missing=1
          else
            echo ' ddc-cell-image'
          fi
          
          if [[ ! -x dist/ddc-cell-js ]]; then
            echo ' MISSING: ddc-cell-js'
            missing=1
          else
            echo ' ddc-cell-js'
          fi
          
          if [[ ! -x dist/ddc-cell-jxl ]]; then
            echo ' MISSING: ddc-cell-jxl'
            missing=1
          else
            echo ' ddc-cell-jxl'
          fi
          
          if [[ ! -x dist/ddc-cell-linkcheck ]]; then
            echo ' MISSING: ddc-cell-linkcheck'
            missing=1
          else
            echo ' ddc-cell-linkcheck'
          fi
          
          if [[ ! -x dist/ddc-cell-markdown ]]; then
            echo ' MISSING: ddc-cell-markdown'
            missing=1
          else
            echo ' ddc-cell-markdown'
          fi
          
          if [[ ! -x dist/ddc-cell-minify ]]; then
            echo ' MISSING: ddc-cell-minify'
            missing=1
          else
            echo ' ddc-cell-minify'
          fi
          
          if [[ ! -x dist/ddc-cell-sass ]]; then
            echo ' MISSING: ddc-cell-sass'
            missing=1
          else
            echo ' ddc-cell-sass'
          fi
          
          if [[ ! -x dist/ddc-cell-svgo ]]; then
            echo ' MISSING: ddc-cell-svgo'
            missing=1
          else
            echo ' ddc-cell-svgo'
          fi
          
          if [[ ! -x dist/ddc-cell-term ]]; then
            echo ' MISSING: ddc-cell-term'
            missing=1
          else
            echo ' ddc-cell-term'
          fi
          
          if [[ ! -x dist/ddc-cell-tui ]]; then
            echo ' MISSING: ddc-cell-tui'
            missing=1
          else
            echo ' ddc-cell-tui'
          fi
          
          if [[ ! -x dist/ddc-cell-webp ]]; then
            echo ' MISSING: ddc-cell-webp'
            missing=1
          else
            echo ' ddc-cell-webp'
          fi
          
          if [[ $missing -eq 1 ]]; then
            echo ''
            echo 'ERROR: Some required binaries are missing!'
            echo 'This usually means a cell build job failed or artifact upload was incomplete.'
            exit 1
          fi
          
          echo ''
          echo 'All 20 binaries verified.'
      - name: Run integration tests
        run: cargo xtask integration --no-build
        env: 
          DODECA_BIN: ${{ github.workspace }}/dist/ddc
          DODECA_CELL_PATH: ${{ github.workspace }}/dist
          DODECA_TEST_FIXTURES_DIR: ${{ github.workspace }}/crates/integration-tests/fixtures
      - name: Save cache (ctree)
        run: |-
          echo "=== Cache contents before save ==="
          du -sh target 2>/dev/null || true
          tree -ah -L 2 target/ 2>/dev/null || find target -maxdepth 2 -type d
          mkdir -p "$(dirname "/Users/amos/.cache/dodeca-ci/integration-macos-arm64")"
          rm -rf "/Users/amos/.cache/dodeca-ci/integration-macos-arm64" 2>/dev/null || true
          ctree target "/Users/amos/.cache/dodeca-ci/integration-macos-arm64" && echo "Cache saved via ctree to /Users/amos/.cache/dodeca-ci/integration-macos-arm64" || echo "ctree save failed (non-fatal)"
      - name: Trim cache (cargo sweep)
        run: |-
          if [ -d "/Users/amos/.cache/dodeca-ci/integration-macos-arm64" ]; then
            CARGO_TARGET_DIR="/Users/amos/.cache/dodeca-ci/integration-macos-arm64" cargo sweep --file || true
          else
            echo "No cache found at /Users/amos/.cache/dodeca-ci/integration-macos-arm64 to trim"
          fi
  assemble-macos-arm64: 
    name: Assemble (macos-arm64)
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    needs: 
      - integration-macos-arm64
      - build-wasm
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Download ddc from CAS
        run: "./scripts/cas-download.ts \"ci/${{ github.run_id }}/ddc-macos-arm64\" target/release/ddc"
      - name: Download cells from CAS
        run: |-
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-1" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-2" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-3" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-4" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-5" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-6" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-7" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-8" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-9" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-10" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-11" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-12" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-13" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-14" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-15" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-16" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-17" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-18" target/release/
          ./scripts/cas-download-batch.ts "ci/${{ github.run_id }}/cells-macos-arm64-19" target/release/
      - name: Download WASM from CAS
        run: |-
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/wasm.tar.gz" /tmp/wasm.tar.gz
          mkdir -p crates/dodeca-devtools
          tar -xzf /tmp/wasm.tar.gz -C crates/dodeca-devtools
      - name: Install xz (macOS)
        run: if command -v brew >/dev/null 2>&1; then HOMEBREW_NO_AUTO_UPDATE=1 brew install xz; fi
      - name: List binaries
        run: ls -la target/release/
      - name: Assemble archive
        run: bash scripts/assemble-archive.sh aarch64-apple-darwin
      - name: Upload archive to CAS
        run: "./scripts/cas-upload.ts \"dodeca-aarch64-apple-darwin.tar.xz\" \"ci/${{ github.run_id }}/dodeca-aarch64-apple-darwin.tar.xz\""
  release: 
    name: Release
    runs-on: 
      - linux-amd64-metal
    timeout-minutes: 30
    needs: 
      - assemble-linux-x64
      - assemble-macos-arm64
    if: "startsWith(github.ref, 'refs/tags/')"
    env: 
      CAS_SSH_KEY: ${{ secrets.CAS_SSH_KEY }}
    steps: 
      - name: Checkout
        uses: "https://github.com/actions/checkout@v4"
      - name: Download archives from CAS
        run: |-
          mkdir -p dist
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/dodeca-x86_64-unknown-linux-gnu.tar.xz" dist/dodeca-x86_64-unknown-linux-gnu.tar.xz
          ./scripts/cas-download.ts "ci/${{ github.run_id }}/dodeca-aarch64-apple-darwin.tar.xz" dist/dodeca-aarch64-apple-darwin.tar.xz
          ls -la dist/
      - name: Show release info
        run: "echo \"Release: ${{ github.ref_name }}\"; ls -la dist/"
