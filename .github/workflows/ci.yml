# GENERATED BY: cargo xtask ci
# DO NOT EDIT - edit xtask/src/ci.rs instead

---
name: CI
"on": 
  push: 
    tags: 
      - v*
    branches: 
      - main
  pull_request: 
    branches: 
      - main
  merge_group: 
    branches: 
      - main
  workflow_dispatch: {}
permissions: 
  contents: read
env: 
  CARGO_TERM_COLOR: always
jobs: 
  clippy: 
    name: Clippy
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    continue-on-error: true
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
          components: clippy
          targets: wasm32-unknown-unknown
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "false"
      - name: Clippy
        run: cargo clippy --all-features --all-targets -- -D warnings
  build-wasm: 
    name: Build WASM
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
          targets: wasm32-unknown-unknown
      - name: Add WASM target
        run: rustup target add wasm32-unknown-unknown
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "false"
      - name: Install wasm-bindgen-cli
        run: cargo install wasm-bindgen-cli --locked
      - name: Build WASM
        run: cargo xtask wasm
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: dodeca-devtools-wasm
          path: crates/dodeca-devtools/pkg
  build-ddc-linux-x64: 
    name: Build ddc (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "false"
      - name: Build ddc
        run: cargo build --release -p dodeca --verbose
      - name: Test ddc
        run: cargo test --release -p dodeca --bins
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: ddc-linux-x64
          path: target/release/ddc
  build-cells-linux-x64-1: 
    name: Build cells (linux-x64) [cell-code-execution]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-code-execution --bin ddc-cell-code-execution --verbose
      - name: Test cells
        run: cargo test --release -p cell-code-execution
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-1
          path: target/release/ddc-cell-code-execution
  build-cells-linux-x64-2: 
    name: Build cells (linux-x64) [cell-css]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-css --bin ddc-cell-css --verbose
      - name: Test cells
        run: cargo test --release -p cell-css
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-2
          path: target/release/ddc-cell-css
  build-cells-linux-x64-3: 
    name: Build cells (linux-x64) [cell-dialoguer]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-dialoguer --bin ddc-cell-dialoguer --verbose
      - name: Test cells
        run: cargo test --release -p cell-dialoguer
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-3
          path: target/release/ddc-cell-dialoguer
  build-cells-linux-x64-4: 
    name: Build cells (linux-x64) [cell-fonts]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-fonts --bin ddc-cell-fonts --verbose
      - name: Test cells
        run: cargo test --release -p cell-fonts
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-4
          path: target/release/ddc-cell-fonts
  build-cells-linux-x64-5: 
    name: Build cells (linux-x64) [cell-gingembre]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-gingembre --bin ddc-cell-gingembre --verbose
      - name: Test cells
        run: cargo test --release -p cell-gingembre
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-5
          path: target/release/ddc-cell-gingembre
  build-cells-linux-x64-6: 
    name: Build cells (linux-x64) [cell-html]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-html --bin ddc-cell-html --verbose
      - name: Test cells
        run: cargo test --release -p cell-html
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-6
          path: target/release/ddc-cell-html
  build-cells-linux-x64-7: 
    name: Build cells (linux-x64) [cell-html-diff]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-html-diff --bin ddc-cell-html-diff --verbose
      - name: Test cells
        run: cargo test --release -p cell-html-diff
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-7
          path: target/release/ddc-cell-html-diff
  build-cells-linux-x64-8: 
    name: Build cells (linux-x64) [cell-http]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-http --bin ddc-cell-http --verbose
      - name: Test cells
        run: cargo test --release -p cell-http
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-8
          path: target/release/ddc-cell-http
  build-cells-linux-x64-9: 
    name: Build cells (linux-x64) [cell-image]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-image --bin ddc-cell-image --verbose
      - name: Test cells
        run: cargo test --release -p cell-image
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-9
          path: target/release/ddc-cell-image
  build-cells-linux-x64-10: 
    name: Build cells (linux-x64) [cell-js]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-js --bin ddc-cell-js --verbose
      - name: Test cells
        run: cargo test --release -p cell-js
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-10
          path: target/release/ddc-cell-js
  build-cells-linux-x64-11: 
    name: Build cells (linux-x64) [cell-jxl]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-jxl --bin ddc-cell-jxl --verbose
      - name: Test cells
        run: cargo test --release -p cell-jxl
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-11
          path: target/release/ddc-cell-jxl
  build-cells-linux-x64-12: 
    name: Build cells (linux-x64) [cell-linkcheck]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-linkcheck --bin ddc-cell-linkcheck --verbose
      - name: Test cells
        run: cargo test --release -p cell-linkcheck
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-12
          path: target/release/ddc-cell-linkcheck
  build-cells-linux-x64-13: 
    name: Build cells (linux-x64) [cell-markdown]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-markdown --bin ddc-cell-markdown --verbose
      - name: Test cells
        run: cargo test --release -p cell-markdown
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-13
          path: target/release/ddc-cell-markdown
  build-cells-linux-x64-14: 
    name: Build cells (linux-x64) [cell-minify]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-minify --bin ddc-cell-minify --verbose
      - name: Test cells
        run: cargo test --release -p cell-minify
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-14
          path: target/release/ddc-cell-minify
  build-cells-linux-x64-15: 
    name: Build cells (linux-x64) [cell-pagefind]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-pagefind --bin ddc-cell-pagefind --verbose
      - name: Test cells
        run: cargo test --release -p cell-pagefind
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-15
          path: target/release/ddc-cell-pagefind
  build-cells-linux-x64-16: 
    name: Build cells (linux-x64) [cell-sass]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-sass --bin ddc-cell-sass --verbose
      - name: Test cells
        run: cargo test --release -p cell-sass
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-16
          path: target/release/ddc-cell-sass
  build-cells-linux-x64-17: 
    name: Build cells (linux-x64) [cell-svgo]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-svgo --bin ddc-cell-svgo --verbose
      - name: Test cells
        run: cargo test --release -p cell-svgo
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-17
          path: target/release/ddc-cell-svgo
  build-cells-linux-x64-18: 
    name: Build cells (linux-x64) [cell-tui]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-tui --bin ddc-cell-tui --verbose
      - name: Test cells
        run: cargo test --release -p cell-tui
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-18
          path: target/release/ddc-cell-tui
  build-cells-linux-x64-19: 
    name: Build cells (linux-x64) [cell-webp]
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
      - name: Build cells
        run: cargo build --release -p cell-webp --bin ddc-cell-webp --verbose
      - name: Test cells
        run: cargo test --release -p cell-webp
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-linux-x64-19
          path: target/release/ddc-cell-webp
  integration-linux-x64: 
    name: Integration (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    needs: 
      - build-ddc-linux-x64
      - build-cells-linux-x64-1
      - build-cells-linux-x64-2
      - build-cells-linux-x64-3
      - build-cells-linux-x64-4
      - build-cells-linux-x64-5
      - build-cells-linux-x64-6
      - build-cells-linux-x64-7
      - build-cells-linux-x64-8
      - build-cells-linux-x64-9
      - build-cells-linux-x64-10
      - build-cells-linux-x64-11
      - build-cells-linux-x64-12
      - build-cells-linux-x64-13
      - build-cells-linux-x64-14
      - build-cells-linux-x64-15
      - build-cells-linux-x64-16
      - build-cells-linux-x64-17
      - build-cells-linux-x64-18
      - build-cells-linux-x64-19
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "false"
      - name: Build integration-tests
        run: cargo build -p integration-tests
      - name: Download ddc
        uses: actions/download-artifact@v4
        with: 
          name: ddc-linux-x64
          path: dist
      - name: Download cells
        uses: actions/download-artifact@v4
        with: 
          pattern: cells-linux-x64-*
          path: dist
          merge-multiple: "true"
      - name: Flatten cell directories
        run: find dist -mindepth 2 -type f -exec mv -t dist {} + 2>/dev/null || true; find dist -mindepth 1 -type d -empty -delete 2>/dev/null || true
      - name: Prepare binaries
        run: chmod +x dist/ddc* && ls -la dist/
      - name: Verify artifacts
        run: |
          #!/bin/bash
          set -euo pipefail
          
          echo 'Verifying all required binaries exist in dist/'
          missing=0
          
          if [[ ! -x dist/ddc ]]; then
            echo '❌ MISSING: ddc'
            missing=1
          else
            echo '✓ ddc'
          fi
          
          if [[ ! -x dist/ddc-cell-code-execution ]]; then
            echo '❌ MISSING: ddc-cell-code-execution'
            missing=1
          else
            echo '✓ ddc-cell-code-execution'
          fi
          
          if [[ ! -x dist/ddc-cell-css ]]; then
            echo '❌ MISSING: ddc-cell-css'
            missing=1
          else
            echo '✓ ddc-cell-css'
          fi
          
          if [[ ! -x dist/ddc-cell-dialoguer ]]; then
            echo '❌ MISSING: ddc-cell-dialoguer'
            missing=1
          else
            echo '✓ ddc-cell-dialoguer'
          fi
          
          if [[ ! -x dist/ddc-cell-fonts ]]; then
            echo '❌ MISSING: ddc-cell-fonts'
            missing=1
          else
            echo '✓ ddc-cell-fonts'
          fi
          
          if [[ ! -x dist/ddc-cell-gingembre ]]; then
            echo '❌ MISSING: ddc-cell-gingembre'
            missing=1
          else
            echo '✓ ddc-cell-gingembre'
          fi
          
          if [[ ! -x dist/ddc-cell-html ]]; then
            echo '❌ MISSING: ddc-cell-html'
            missing=1
          else
            echo '✓ ddc-cell-html'
          fi
          
          if [[ ! -x dist/ddc-cell-html-diff ]]; then
            echo '❌ MISSING: ddc-cell-html-diff'
            missing=1
          else
            echo '✓ ddc-cell-html-diff'
          fi
          
          if [[ ! -x dist/ddc-cell-http ]]; then
            echo '❌ MISSING: ddc-cell-http'
            missing=1
          else
            echo '✓ ddc-cell-http'
          fi
          
          if [[ ! -x dist/ddc-cell-image ]]; then
            echo '❌ MISSING: ddc-cell-image'
            missing=1
          else
            echo '✓ ddc-cell-image'
          fi
          
          if [[ ! -x dist/ddc-cell-js ]]; then
            echo '❌ MISSING: ddc-cell-js'
            missing=1
          else
            echo '✓ ddc-cell-js'
          fi
          
          if [[ ! -x dist/ddc-cell-jxl ]]; then
            echo '❌ MISSING: ddc-cell-jxl'
            missing=1
          else
            echo '✓ ddc-cell-jxl'
          fi
          
          if [[ ! -x dist/ddc-cell-linkcheck ]]; then
            echo '❌ MISSING: ddc-cell-linkcheck'
            missing=1
          else
            echo '✓ ddc-cell-linkcheck'
          fi
          
          if [[ ! -x dist/ddc-cell-markdown ]]; then
            echo '❌ MISSING: ddc-cell-markdown'
            missing=1
          else
            echo '✓ ddc-cell-markdown'
          fi
          
          if [[ ! -x dist/ddc-cell-minify ]]; then
            echo '❌ MISSING: ddc-cell-minify'
            missing=1
          else
            echo '✓ ddc-cell-minify'
          fi
          
          if [[ ! -x dist/ddc-cell-pagefind ]]; then
            echo '❌ MISSING: ddc-cell-pagefind'
            missing=1
          else
            echo '✓ ddc-cell-pagefind'
          fi
          
          if [[ ! -x dist/ddc-cell-sass ]]; then
            echo '❌ MISSING: ddc-cell-sass'
            missing=1
          else
            echo '✓ ddc-cell-sass'
          fi
          
          if [[ ! -x dist/ddc-cell-svgo ]]; then
            echo '❌ MISSING: ddc-cell-svgo'
            missing=1
          else
            echo '✓ ddc-cell-svgo'
          fi
          
          if [[ ! -x dist/ddc-cell-tui ]]; then
            echo '❌ MISSING: ddc-cell-tui'
            missing=1
          else
            echo '✓ ddc-cell-tui'
          fi
          
          if [[ ! -x dist/ddc-cell-webp ]]; then
            echo '❌ MISSING: ddc-cell-webp'
            missing=1
          else
            echo '✓ ddc-cell-webp'
          fi
          
          if [[ $missing -eq 1 ]]; then
            echo ''
            echo 'ERROR: Some required binaries are missing!'
            echo 'This usually means a cell build job failed or artifact upload was incomplete.'
            exit 1
          fi
          
          echo ''
          echo 'All 20 binaries verified.'
      - name: Run integration tests
        run: cargo xtask integration --no-build
        env: 
          DODECA_BIN: ${{ github.workspace }}/dist/ddc
          DODECA_CELL_PATH: ${{ github.workspace }}/dist
          DODECA_TEST_FIXTURES_DIR: ${{ github.workspace }}/crates/integration-tests/fixtures
  browser-tests-linux-x64: 
    name: Browser Tests (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    needs: 
      - build-ddc-linux-x64
      - build-wasm
      - build-cells-linux-x64-1
      - build-cells-linux-x64-2
      - build-cells-linux-x64-3
      - build-cells-linux-x64-4
      - build-cells-linux-x64-5
      - build-cells-linux-x64-6
      - build-cells-linux-x64-7
      - build-cells-linux-x64-8
      - build-cells-linux-x64-9
      - build-cells-linux-x64-10
      - build-cells-linux-x64-11
      - build-cells-linux-x64-12
      - build-cells-linux-x64-13
      - build-cells-linux-x64-14
      - build-cells-linux-x64-15
      - build-cells-linux-x64-16
      - build-cells-linux-x64-17
      - build-cells-linux-x64-18
      - build-cells-linux-x64-19
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Download ddc
        uses: actions/download-artifact@v4
        with: 
          name: ddc-linux-x64
          path: dist
      - name: Download cells
        uses: actions/download-artifact@v4
        with: 
          pattern: cells-linux-x64-*
          path: dist
          merge-multiple: "true"
      - name: Flatten cell directories
        run: find dist -mindepth 2 -type f -exec mv -t dist {} + 2>/dev/null || true; find dist -mindepth 1 -type d -empty -delete 2>/dev/null || true
      - name: Download WASM
        uses: actions/download-artifact@v4
        with: 
          name: dodeca-devtools-wasm
          path: crates/dodeca-devtools/pkg
      - name: Prepare binaries
        run: chmod +x dist/ddc* && ls -la dist/
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with: 
          node-version: "20"
      - name: Install browser test dependencies
        run: cd browser-tests && npm ci && npx playwright install chromium --with-deps
      - name: Run browser tests
        run: cd browser-tests && npm test
        env: 
          DODECA_BIN: ${{ github.workspace }}/dist/ddc
          DODECA_CELL_PATH: ${{ github.workspace }}/dist
  assemble-linux-x64: 
    name: Assemble (linux-x64)
    runs-on: 
      - depot-ubuntu-24.04-32
    timeout-minutes: 30
    needs: 
      - integration-linux-x64
      - build-wasm
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Download ddc
        uses: actions/download-artifact@v4
        with: 
          name: ddc-linux-x64
          path: target/release
      - name: Download cells
        uses: actions/download-artifact@v4
        with: 
          pattern: cells-linux-x64-*
          path: target/release
          merge-multiple: "true"
      - name: Flatten cell directories
        run: find target/release -mindepth 2 -type f -exec mv -t target/release {} + 2>/dev/null || true; find target/release -mindepth 1 -type d -empty -delete 2>/dev/null || true
      - name: Download WASM
        uses: actions/download-artifact@v4
        with: 
          name: dodeca-devtools-wasm
          path: crates/dodeca-devtools/pkg
      - name: Install xz (macOS)
        run: if command -v brew >/dev/null 2>&1; then HOMEBREW_NO_AUTO_UPDATE=1 brew install xz; fi
      - name: List binaries
        run: ls -la target/release/
      - name: Assemble archive
        run: bash scripts/assemble-archive.sh x86_64-unknown-linux-gnu
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: build-linux-x64
          path: dodeca-x86_64-unknown-linux-gnu.tar.xz
  build-ddc-macos-arm64: 
    name: Build ddc (macos-arm64)
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "false"
          cache-bin: "false"
      - name: Build ddc
        run: cargo build --release -p dodeca --verbose
      - name: Test ddc
        run: cargo test --release -p dodeca --bins
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: ddc-macos-arm64
          path: target/release/ddc
  build-cells-macos-arm64-1: 
    name: Build cells (macos-arm64) [cell-code-execution]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-code-execution --bin ddc-cell-code-execution --verbose
      - name: Test cells
        run: cargo test --release -p cell-code-execution
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-1
          path: target/release/ddc-cell-code-execution
  build-cells-macos-arm64-2: 
    name: Build cells (macos-arm64) [cell-css]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-css --bin ddc-cell-css --verbose
      - name: Test cells
        run: cargo test --release -p cell-css
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-2
          path: target/release/ddc-cell-css
  build-cells-macos-arm64-3: 
    name: Build cells (macos-arm64) [cell-dialoguer]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-dialoguer --bin ddc-cell-dialoguer --verbose
      - name: Test cells
        run: cargo test --release -p cell-dialoguer
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-3
          path: target/release/ddc-cell-dialoguer
  build-cells-macos-arm64-4: 
    name: Build cells (macos-arm64) [cell-fonts]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-fonts --bin ddc-cell-fonts --verbose
      - name: Test cells
        run: cargo test --release -p cell-fonts
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-4
          path: target/release/ddc-cell-fonts
  build-cells-macos-arm64-5: 
    name: Build cells (macos-arm64) [cell-gingembre]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-gingembre --bin ddc-cell-gingembre --verbose
      - name: Test cells
        run: cargo test --release -p cell-gingembre
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-5
          path: target/release/ddc-cell-gingembre
  build-cells-macos-arm64-6: 
    name: Build cells (macos-arm64) [cell-html]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-html --bin ddc-cell-html --verbose
      - name: Test cells
        run: cargo test --release -p cell-html
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-6
          path: target/release/ddc-cell-html
  build-cells-macos-arm64-7: 
    name: Build cells (macos-arm64) [cell-html-diff]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-html-diff --bin ddc-cell-html-diff --verbose
      - name: Test cells
        run: cargo test --release -p cell-html-diff
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-7
          path: target/release/ddc-cell-html-diff
  build-cells-macos-arm64-8: 
    name: Build cells (macos-arm64) [cell-http]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-http --bin ddc-cell-http --verbose
      - name: Test cells
        run: cargo test --release -p cell-http
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-8
          path: target/release/ddc-cell-http
  build-cells-macos-arm64-9: 
    name: Build cells (macos-arm64) [cell-image]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-image --bin ddc-cell-image --verbose
      - name: Test cells
        run: cargo test --release -p cell-image
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-9
          path: target/release/ddc-cell-image
  build-cells-macos-arm64-10: 
    name: Build cells (macos-arm64) [cell-js]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-js --bin ddc-cell-js --verbose
      - name: Test cells
        run: cargo test --release -p cell-js
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-10
          path: target/release/ddc-cell-js
  build-cells-macos-arm64-11: 
    name: Build cells (macos-arm64) [cell-jxl]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-jxl --bin ddc-cell-jxl --verbose
      - name: Test cells
        run: cargo test --release -p cell-jxl
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-11
          path: target/release/ddc-cell-jxl
  build-cells-macos-arm64-12: 
    name: Build cells (macos-arm64) [cell-linkcheck]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-linkcheck --bin ddc-cell-linkcheck --verbose
      - name: Test cells
        run: cargo test --release -p cell-linkcheck
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-12
          path: target/release/ddc-cell-linkcheck
  build-cells-macos-arm64-13: 
    name: Build cells (macos-arm64) [cell-markdown]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-markdown --bin ddc-cell-markdown --verbose
      - name: Test cells
        run: cargo test --release -p cell-markdown
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-13
          path: target/release/ddc-cell-markdown
  build-cells-macos-arm64-14: 
    name: Build cells (macos-arm64) [cell-minify]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-minify --bin ddc-cell-minify --verbose
      - name: Test cells
        run: cargo test --release -p cell-minify
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-14
          path: target/release/ddc-cell-minify
  build-cells-macos-arm64-15: 
    name: Build cells (macos-arm64) [cell-pagefind]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-pagefind --bin ddc-cell-pagefind --verbose
      - name: Test cells
        run: cargo test --release -p cell-pagefind
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-15
          path: target/release/ddc-cell-pagefind
  build-cells-macos-arm64-16: 
    name: Build cells (macos-arm64) [cell-sass]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-sass --bin ddc-cell-sass --verbose
      - name: Test cells
        run: cargo test --release -p cell-sass
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-16
          path: target/release/ddc-cell-sass
  build-cells-macos-arm64-17: 
    name: Build cells (macos-arm64) [cell-svgo]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-svgo --bin ddc-cell-svgo --verbose
      - name: Test cells
        run: cargo test --release -p cell-svgo
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-17
          path: target/release/ddc-cell-svgo
  build-cells-macos-arm64-18: 
    name: Build cells (macos-arm64) [cell-tui]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-tui --bin ddc-cell-tui --verbose
      - name: Test cells
        run: cargo test --release -p cell-tui
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-18
          path: target/release/ddc-cell-tui
  build-cells-macos-arm64-19: 
    name: Build cells (macos-arm64) [cell-webp]
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "true"
          cache-bin: "false"
      - name: Build cells
        run: cargo build --release -p cell-webp --bin ddc-cell-webp --verbose
      - name: Test cells
        run: cargo test --release -p cell-webp
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: cells-macos-arm64-19
          path: target/release/ddc-cell-webp
  integration-macos-arm64: 
    name: Integration (macos-arm64)
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    needs: 
      - build-ddc-macos-arm64
      - build-cells-macos-arm64-1
      - build-cells-macos-arm64-2
      - build-cells-macos-arm64-3
      - build-cells-macos-arm64-4
      - build-cells-macos-arm64-5
      - build-cells-macos-arm64-6
      - build-cells-macos-arm64-7
      - build-cells-macos-arm64-8
      - build-cells-macos-arm64-9
      - build-cells-macos-arm64-10
      - build-cells-macos-arm64-11
      - build-cells-macos-arm64-12
      - build-cells-macos-arm64-13
      - build-cells-macos-arm64-14
      - build-cells-macos-arm64-15
      - build-cells-macos-arm64-16
      - build-cells-macos-arm64-17
      - build-cells-macos-arm64-18
      - build-cells-macos-arm64-19
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@master
        with: 
          toolchain: 1.92.0
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
        with: 
          cache-on-failure: "true"
          cache-targets: "false"
          cache-bin: "false"
      - name: Build integration-tests
        run: cargo build -p integration-tests
      - name: Download ddc
        uses: actions/download-artifact@v4
        with: 
          name: ddc-macos-arm64
          path: dist
      - name: Download cells
        uses: actions/download-artifact@v4
        with: 
          pattern: cells-macos-arm64-*
          path: dist
          merge-multiple: "true"
      - name: Flatten cell directories
        run: find dist -mindepth 2 -type f -exec mv -t dist {} + 2>/dev/null || true; find dist -mindepth 1 -type d -empty -delete 2>/dev/null || true
      - name: Prepare binaries
        run: chmod +x dist/ddc* && ls -la dist/
      - name: Verify artifacts
        run: |
          #!/bin/bash
          set -euo pipefail
          
          echo 'Verifying all required binaries exist in dist/'
          missing=0
          
          if [[ ! -x dist/ddc ]]; then
            echo '❌ MISSING: ddc'
            missing=1
          else
            echo '✓ ddc'
          fi
          
          if [[ ! -x dist/ddc-cell-code-execution ]]; then
            echo '❌ MISSING: ddc-cell-code-execution'
            missing=1
          else
            echo '✓ ddc-cell-code-execution'
          fi
          
          if [[ ! -x dist/ddc-cell-css ]]; then
            echo '❌ MISSING: ddc-cell-css'
            missing=1
          else
            echo '✓ ddc-cell-css'
          fi
          
          if [[ ! -x dist/ddc-cell-dialoguer ]]; then
            echo '❌ MISSING: ddc-cell-dialoguer'
            missing=1
          else
            echo '✓ ddc-cell-dialoguer'
          fi
          
          if [[ ! -x dist/ddc-cell-fonts ]]; then
            echo '❌ MISSING: ddc-cell-fonts'
            missing=1
          else
            echo '✓ ddc-cell-fonts'
          fi
          
          if [[ ! -x dist/ddc-cell-gingembre ]]; then
            echo '❌ MISSING: ddc-cell-gingembre'
            missing=1
          else
            echo '✓ ddc-cell-gingembre'
          fi
          
          if [[ ! -x dist/ddc-cell-html ]]; then
            echo '❌ MISSING: ddc-cell-html'
            missing=1
          else
            echo '✓ ddc-cell-html'
          fi
          
          if [[ ! -x dist/ddc-cell-html-diff ]]; then
            echo '❌ MISSING: ddc-cell-html-diff'
            missing=1
          else
            echo '✓ ddc-cell-html-diff'
          fi
          
          if [[ ! -x dist/ddc-cell-http ]]; then
            echo '❌ MISSING: ddc-cell-http'
            missing=1
          else
            echo '✓ ddc-cell-http'
          fi
          
          if [[ ! -x dist/ddc-cell-image ]]; then
            echo '❌ MISSING: ddc-cell-image'
            missing=1
          else
            echo '✓ ddc-cell-image'
          fi
          
          if [[ ! -x dist/ddc-cell-js ]]; then
            echo '❌ MISSING: ddc-cell-js'
            missing=1
          else
            echo '✓ ddc-cell-js'
          fi
          
          if [[ ! -x dist/ddc-cell-jxl ]]; then
            echo '❌ MISSING: ddc-cell-jxl'
            missing=1
          else
            echo '✓ ddc-cell-jxl'
          fi
          
          if [[ ! -x dist/ddc-cell-linkcheck ]]; then
            echo '❌ MISSING: ddc-cell-linkcheck'
            missing=1
          else
            echo '✓ ddc-cell-linkcheck'
          fi
          
          if [[ ! -x dist/ddc-cell-markdown ]]; then
            echo '❌ MISSING: ddc-cell-markdown'
            missing=1
          else
            echo '✓ ddc-cell-markdown'
          fi
          
          if [[ ! -x dist/ddc-cell-minify ]]; then
            echo '❌ MISSING: ddc-cell-minify'
            missing=1
          else
            echo '✓ ddc-cell-minify'
          fi
          
          if [[ ! -x dist/ddc-cell-pagefind ]]; then
            echo '❌ MISSING: ddc-cell-pagefind'
            missing=1
          else
            echo '✓ ddc-cell-pagefind'
          fi
          
          if [[ ! -x dist/ddc-cell-sass ]]; then
            echo '❌ MISSING: ddc-cell-sass'
            missing=1
          else
            echo '✓ ddc-cell-sass'
          fi
          
          if [[ ! -x dist/ddc-cell-svgo ]]; then
            echo '❌ MISSING: ddc-cell-svgo'
            missing=1
          else
            echo '✓ ddc-cell-svgo'
          fi
          
          if [[ ! -x dist/ddc-cell-tui ]]; then
            echo '❌ MISSING: ddc-cell-tui'
            missing=1
          else
            echo '✓ ddc-cell-tui'
          fi
          
          if [[ ! -x dist/ddc-cell-webp ]]; then
            echo '❌ MISSING: ddc-cell-webp'
            missing=1
          else
            echo '✓ ddc-cell-webp'
          fi
          
          if [[ $missing -eq 1 ]]; then
            echo ''
            echo 'ERROR: Some required binaries are missing!'
            echo 'This usually means a cell build job failed or artifact upload was incomplete.'
            exit 1
          fi
          
          echo ''
          echo 'All 20 binaries verified.'
      - name: Run integration tests
        run: cargo xtask integration --no-build
        env: 
          DODECA_BIN: ${{ github.workspace }}/dist/ddc
          DODECA_CELL_PATH: ${{ github.workspace }}/dist
          DODECA_TEST_FIXTURES_DIR: ${{ github.workspace }}/crates/integration-tests/fixtures
  assemble-macos-arm64: 
    name: Assemble (macos-arm64)
    runs-on: 
      - mac-arm64-oakhost
    timeout-minutes: 30
    needs: 
      - integration-macos-arm64
      - build-wasm
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Download ddc
        uses: actions/download-artifact@v4
        with: 
          name: ddc-macos-arm64
          path: target/release
      - name: Download cells
        uses: actions/download-artifact@v4
        with: 
          pattern: cells-macos-arm64-*
          path: target/release
          merge-multiple: "true"
      - name: Flatten cell directories
        run: find target/release -mindepth 2 -type f -exec mv -t target/release {} + 2>/dev/null || true; find target/release -mindepth 1 -type d -empty -delete 2>/dev/null || true
      - name: Download WASM
        uses: actions/download-artifact@v4
        with: 
          name: dodeca-devtools-wasm
          path: crates/dodeca-devtools/pkg
      - name: Install xz (macOS)
        run: if command -v brew >/dev/null 2>&1; then HOMEBREW_NO_AUTO_UPDATE=1 brew install xz; fi
      - name: List binaries
        run: ls -la target/release/
      - name: Assemble archive
        run: bash scripts/assemble-archive.sh aarch64-apple-darwin
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with: 
          name: build-macos-arm64
          path: dodeca-aarch64-apple-darwin.tar.xz
  release: 
    name: Release
    runs-on: 
      - ubuntu-latest
    timeout-minutes: 30
    needs: 
      - assemble-linux-x64
      - assemble-macos-arm64
    if: "startsWith(github.ref, 'refs/tags/')"
    env: 
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      HOMEBREW_TAP_TOKEN: ${{ secrets.HOMEBREW_TAP_TOKEN }}
    permissions: 
      contents: write
    steps: 
      - name: Checkout
        uses: actions/checkout@v4
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with: 
          path: dist
          pattern: build-*
          merge-multiple: "true"
      - name: List artifacts (before flatten)
        run: ls -laR dist/
      - name: Flatten artifact directories
        run: find dist -mindepth 2 -type f -exec mv -t dist {} + 2>/dev/null || true; find dist -mindepth 1 -type d -empty -delete 2>/dev/null || true
      - name: List artifacts (after flatten)
        run: ls -la dist/
      - name: Create GitHub Release
        run: |-
          shopt -s nullglob
          # Rename install.sh to dodeca-installer.sh for the release
          cp install.sh dist/dodeca-installer.sh
          gh release create "${{ github.ref_name }}" \
            --title "dodeca ${{ github.ref_name }}" \
            --generate-notes \
            dist/*.tar.xz dist/*.zip dist/dodeca-installer.sh
        shell: bash
      - name: Update Homebrew tap
        run: "bash scripts/update-homebrew.sh \"${{ github.ref_name }}\""
        shell: bash
