[workspace]
members = [
    "crates/*",
    "cells/*",
    "xtask",
]
resolver = "3"

[workspace.dependencies]
rapace = { path = "../rapace/crates/rapace", default-features = false }
rapace-core = { path = "../rapace/crates/rapace-core" }
rapace-cell = { path = "../rapace/crates/rapace-cell" }
rapace-tracing = { path = "../rapace/crates/rapace-tracing" }
ur-taking-me-with-you = { path = "../rapace/crates/ur-taking-me-with-you", features = ["tokio"] }

# Optimize dependencies in dev mode for faster tests
# (keeps main crate unoptimized for fast incremental builds)
[profile.dev.package."*"]
opt-level = 2

# Reduce debug info size (line tables only, no variable info)
# Light optimization for better runtime without killing incremental builds
[profile.dev]
debug = "line-tables-only"
opt-level = 1


# Test profile with full debug symbols for profiling
[profile.test]
inherits = "dev"
debug = true

# The profile that 'dist' will build with
[profile.dist]
inherits = "release"
lto = "thin"

# Debug-friendly profile for investigating mysteries (hangs, crashes, etc.)
# Usage: cargo build --profile mystery
[profile.mystery]
inherits = "release"
opt-level = 1
debug = true
strip = false

# cargo-shear false positives - these deps are used via macros that cargo-shear can't detect
[workspace.metadata.cargo-shear]
ignored = [
    "rapace",               # Used via rapace_cell::cell_service! macro
    "rapace-core",          # Re-exported through rapace
    "facet",                # Used via #[derive(Facet)] macro
    "facet-kdl",            # Used via facet macros
    "color-eyre",           # Used for error setup in cells
    "tracing",              # Used via tracing macros
    "tokio-stream",         # Used for async streaming
    "dodeca-code-execution-types",   # Used by code execution cell
    "dodeca-code-execution-config",  # Used by code execution cell
    "cell-lifecycle-proto", # Used for cell lifecycle management
]
